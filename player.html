<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AstroNeko — Плеєр</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link rel="stylesheet" href="style/player.css">
</head>
<body>
  <header>
  <a href="index.html" class="logo">
    <img src="images/favicon1.png" alt="Logo">
    <h1>AstroNeko</h1>
  </a>
  <nav class="header-nav">
    <a href="index.html">Головна</a>
    <button id="backToInfo">Повернутися до аніме</button>
  </nav>
</header>

  <div class="player-wrapper">
    <video id="anime-player" controls autoplay></video>

    <div class="controls-row">
      <span id="season-or-movie">?</span>
      <span id="episode-number">?</span>
      <span id="episode-title">?</span>
      
      <label for="audio-select">Зміна озвучки:</label>
      <select id="audio-select"></select>

      <button id="prev-episode">Попередня серія</button>
      <button id="next-episode">Наступна серія</button>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const animeId = params.get("id");
    const seasonNumber = parseInt(params.get("season"));
    const episodeNumber = parseInt(params.get("episode"));
    const movieNumber = parseInt(params.get("movie"));

    const player = document.getElementById("anime-player");
    const audioSelect = document.getElementById("audio-select");
    const seasonOrMovieSpan = document.getElementById("season-or-movie");
    const episodeNumSpan = document.getElementById("episode-number");
    const titleSpan = document.getElementById("episode-title");
    const prevBtn = document.getElementById("prev-episode");
    const nextBtn = document.getElementById("next-episode");
    const backToInfoBtn = document.getElementById("backToInfo");

    // Кнопка повернення до сторінки аніме
    backToInfoBtn.onclick = () => {
      window.location.href = `anime-info.html?id=${encodeURIComponent(animeId)}`;
    };

   async function loadPlayer() {
  if (!animeId) {
    alert("Не вказано всі параметри для плеєра!");
    return;
  }

  try {
    const resp = await fetch(`anime/${encodeURIComponent(animeId)}.json`);
    if (!resp.ok) throw new Error("Не вдалося завантажити аніме");
    const anime = await resp.json();

    let isMovie = false;
    let season = null;
    let episode = null;

    if (seasonNumber) {
      season = anime.seasons.find(s => s.seasonNumber === seasonNumber);
      if (!season) throw new Error("Сезон не знайдено");
      episode = season.episodes[episodeNumber - 1];
      if (!episode) throw new Error("Епізод не знайдено");
    } else if (movieNumber) {
      isMovie = true;
      episode = anime.movies[movieNumber - 1];
      if (!episode) throw new Error("Фільм не знайдено");
    } else {
      throw new Error("Не вказано сезон або фільм");
    }

    // Динамічний текст - використовуємо episode.name
    if (isMovie) {
      seasonOrMovieSpan.textContent = `Фільм ${movieNumber}`;
      episodeNumSpan.textContent = "";
    } else {
      seasonOrMovieSpan.textContent = `Сезон ${seasonNumber}`;
      episodeNumSpan.textContent = `Серія ${episodeNumber}`;
    }
    titleSpan.textContent = episode.name; // Змінено з title на name

    // Встановлюємо відео
    player.src = episode.dubbing[0].videoUrl;

    // Заповнюємо select для озвучки
    audioSelect.innerHTML = "";
    episode.dubbing.forEach(d => {
      const option = document.createElement("option");
      option.value = d.videoUrl;
      option.textContent = d.studio;
      audioSelect.appendChild(option);
    });
    audioSelect.onchange = () => {
      player.src = audioSelect.value;
      player.play();
    };

    // Кнопки серії
    if (isMovie) {
      prevBtn.style.display = "none";
      nextBtn.style.display = "none";
    } else {
      prevBtn.style.display = "inline";
      nextBtn.style.display = "inline";

      prevBtn.onclick = () => {
        if (episodeNumber > 1) {
          window.location.href = `player.html?id=${encodeURIComponent(animeId)}&season=${seasonNumber}&episode=${episodeNumber-1}`;
        }
      };

      nextBtn.onclick = () => {
        if (episodeNumber < season.episodes.length) {
          window.location.href = `player.html?id=${encodeURIComponent(animeId)}&season=${seasonNumber}&episode=${episodeNumber+1}`;
        }
      };
    }

  } catch (err) {
    console.error(err);
    alert("Помилка при завантаженні плеєра");
  }
}

    loadPlayer();
    // Auto-hide header functionality for player page
let lastScrollY = window.scrollY;
const header = document.querySelector('header');
const headerHeight = header.offsetHeight;

// Встановлюємо правильний відступ для контенту
document.querySelector('.player-wrapper').style.paddingTop = headerHeight + 'px';

window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY > lastScrollY && currentScrollY > headerHeight) {
        // Скролимо вниз - ховаємо хедер
        header.classList.add('hidden');
    } else {
        // Скролимо вгору - показуємо хедер
        header.classList.remove('hidden');
    }
    
    lastScrollY = currentScrollY;
});

// Додатково: показуємо хедер при ховері
header.addEventListener('mouseenter', () => {
    header.classList.remove('hidden');
});

// Запобігаємо миттєвому хованню при виході курсора
header.addEventListener('mouseleave', () => {
    lastScrollY = window.scrollY;
});
  </script>
</body>
</html>