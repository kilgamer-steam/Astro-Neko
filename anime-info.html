<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AstroNeko ‚Äî –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∞–Ω—ñ–º–µ</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link rel="stylesheet" href="style/anime-info.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
</head>
<body>
  <div class="anime-bg" id="anime-bg"></div>
  
  <header class="site-header">
    <div class="logo">
      <a href="index.html">AstroNeko <img src="images/favicon1.png" alt="logo" style="height:40px; vertical-align: middle;"></a>
    </div>
    <nav class="header-nav">
      <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
    </nav>
  </header>

  <div class="card-container">
    <!-- –ë–ª–æ–∫ –∑ –æ–ø–∏—Å–æ–º —Ç–∞ —Ñ–æ—Ç–æ -->
    <div class="top-section">
      <img id="anime-image" src="" alt="Anime poster">
      <div class="title-description">
        <h1 id="anime-title">–ù–∞–∑–≤–∞ –∞–Ω—ñ–º–µ</h1>
        <div id="anime-description">–û–ø–∏—Å –∞–Ω—ñ–º–µ...</div>
        <div class="info-block">
          <h3>–†–µ–π—Ç–∏–Ω–≥: <span id="anime-rating"></span>‚òÖ</h3>
          <h3>–°—Ç–∞—Ç—É—Å: <span id="anime-status"></span></h3>
          <h3>–¢–∏–ø / –ñ–∞–Ω—Ä: <span id="anime-tags"></span></h3>
          <h3>–°–µ–∑–æ–Ω–∏: <span id="anime-seasons-count"></span></h3>
          <h3>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–µ—Ä—ñ–π: <span id="anime-episodes-count"></span></h3>
          <h3>–í—ñ–∫–æ–≤–∏–π —Ä–µ–π—Ç–∏–Ω–≥: <span id="anime-age"></span></h3>
        </div>
      </div>
    </div>

    <!-- –ë–ª–æ–∫ –∑ —Å–µ–∑–æ–Ω–∞–º–∏ -->
    <div id="seasons-container"></div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const animeId = params.get("id");

    if (!animeId) {
      document.body.innerHTML = "<h2 style='text-align:center; margin-top:50px; color: #00ffe7;'>–ê–Ω—ñ–º–µ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòø</h2>";
    } else {
      loadAnime(animeId);
    }

    async function loadAnime(id) {
      try {
        const response = await fetch(`anime/${encodeURIComponent(id)}.json`);
        if (!response.ok) throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ JSON –¥–ª—è —Ü—å–æ–≥–æ –∞–Ω—ñ–º–µ");

        const anime = await response.json();
        displayAnimeInfo(anime);
      } catch (error) {
        document.body.innerHTML = "<h2 style='text-align:center; margin-top:50px; color: #00ffe7;'>–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞–Ω—ñ–º–µ üòø</h2>";
        console.error(error);
      }
    }

    function displayAnimeInfo(anime) {
      // –§–æ–Ω —Ç–∞ –æ—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
      document.getElementById("anime-bg").style.backgroundImage = `url('${anime.background}')`;
      document.getElementById("anime-image").src = anime.img;
      document.getElementById("anime-title").textContent = anime.title;
      document.getElementById("anime-description").textContent = anime.description;
      document.title = `AstroNeko ‚Äî ${anime.title}`;

      // –ú–µ—Ç–∞-—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
      document.getElementById("anime-tags").textContent = anime.tags.join(", ");
      document.getElementById("anime-status").textContent = anime.status;
      document.getElementById("anime-age").textContent = anime.age;
      document.getElementById("anime-rating").textContent = anime.rating || "N/A";
      document.getElementById("anime-seasons-count").textContent = anime.seasons.length;
      
      const totalEpisodes = anime.seasons.reduce((sum, season) => sum + season.episodes.length, 0);
      document.getElementById("anime-episodes-count").textContent = totalEpisodes;

      // –°–µ–∑–æ–Ω–∏ —Ç–∞ —Å–µ—Ä—ñ—ó
      const seasonsContainer = document.getElementById("seasons-container");
      seasonsContainer.innerHTML = "";

      anime.seasons.forEach(season => {
        const seasonDiv = document.createElement("div");
        seasonDiv.className = "info-block";

        const seasonTitle = document.createElement("h3");
        seasonTitle.textContent = `–°–µ–∑–æ–Ω ${season.seasonNumber}:`;
        seasonDiv.appendChild(seasonTitle);

        const episodesDiv = document.createElement("div");
        episodesDiv.className = "episodes";

        season.episodes.forEach((ep, idx) => {
          const btn = document.createElement("button");
          btn.textContent = ep.title;
          btn.onclick = () => {
            const url = `player.html?id=${encodeURIComponent(anime.id)}&season=${season.seasonNumber}&episode=${idx+1}`;
            window.location.href = url;
          };
          episodesDiv.appendChild(btn);
        });

        seasonDiv.appendChild(episodesDiv);
        seasonsContainer.appendChild(seasonDiv);
      });

      // –§—ñ–ª—å–º–∏, —è–∫—â–æ —î
      if (anime.movies && anime.movies.length > 0) {
        const moviesDiv = document.createElement("div");
        moviesDiv.className = "info-block";

        const moviesTitle = document.createElement("h3");
        moviesTitle.textContent = "–§—ñ–ª—å–º–∏:";
        moviesDiv.appendChild(moviesTitle);

        const moviesList = document.createElement("div");
        moviesList.className = "episodes";

        anime.movies.forEach((movie, idx) => {
          const btn = document.createElement("button");
          btn.textContent = movie.title;
          btn.onclick = () => {
            const url = `player.html?id=${encodeURIComponent(anime.id)}&movie=${idx+1}`;
            window.location.href = url;
          };
          moviesList.appendChild(btn);
        });

        moviesDiv.appendChild(moviesList);
        seasonsContainer.appendChild(moviesDiv);
      }
    }
  </script>
</body>
</html>