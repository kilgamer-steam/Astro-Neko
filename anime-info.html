<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AstroNeko ‚Äî –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∞–Ω—ñ–º–µ</title>
  <link rel="icon" href="images/favicon.png" type="image/png">
  <link rel="stylesheet" href="style/anime-info.css">
</head>
<body>
  <div class="anime-bg" id="anime-bg"></div>
  <header>
  <a href="index.html" class="logo">
    <img src="images/favicon1.png" alt="Logo">
    <h1>AstroNeko</h1>
  </a>
  <nav class="header-nav">
    <a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a>
  </nav>
</header>
  <div class="content-wrapper">
    <div class="main-container">
      <!-- –ë–ª–æ–∫ –∑ –æ–ø–∏—Å–æ–º —Ç–∞ —Ñ–æ—Ç–æ -->
      <section class="anime-info-block">
        <div class="anime-title-section">
          <img id="anime-image" src="" alt="Anime poster">
          <div class="anime-meta">
            <h2 id="anime-title">–ù–∞–∑–≤–∞ –∞–Ω—ñ–º–µ</h2>
            <p id="anime-description">–û–ø–∏—Å –∞–Ω—ñ–º–µ...</p>
            <p><strong>–ñ–∞–Ω—Ä–∏:</strong> <span id="anime-tags"></span></p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="anime-status"></span></p>
            <p><strong>–í—ñ–∫:</strong> <span id="anime-age"></span></p>
            <p><strong>–û—Ü—ñ–Ω–∫–∞:</strong> <span id="anime-rating"></span></p>
          </div>
        </div>
      </section>

      <!-- –ë–ª–æ–∫ –∑ —Å–µ–∑–æ–Ω–∞–º–∏ -->
      <section class="seasons-block">
        <h3>–°–µ–∑–æ–Ω–∏ —Ç–∞ —Å–µ—Ä—ñ—ó</h3>
        <div id="season-list"></div>
      </section>
    </div>
  </div>

  <script>
    // –¢–≤—ñ–π JavaScript –∫–æ–¥ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–µ–∑–º—ñ–Ω–Ω–∏–º
    const params = new URLSearchParams(window.location.search);
    const animeId = params.get("id");

    if (!animeId) {
      document.body.innerHTML = "<h2 style='text-align:center; margin-top:50px;'>–ê–Ω—ñ–º–µ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòø</h2>";
    } else {
      loadAnime(animeId);
    }

    async function loadAnime(id) {
      try {
        const response = await fetch(`anime/${encodeURIComponent(id)}.json`);
        if (!response.ok) throw new Error("–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–Ω–∞–π—Ç–∏ JSON –¥–ª—è —Ü—å–æ–≥–æ –∞–Ω—ñ–º–µ");

        const anime = await response.json();
        displayAnimeInfo(anime);
      } catch (error) {
        document.body.innerHTML = "<h2 style='text-align:center; margin-top:50px;'>–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∞–Ω—ñ–º–µ üòø</h2>";
        console.error(error);
      }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç—ñ
    function formatDuration(seconds) {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        
        if (hours > 0) {
            return `${hours} –≥–æ–¥ ${minutes} —Ö–≤`;
        } else {
            return `${minutes} —Ö–≤`;
        }
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('uk-UA', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    function displayAnimeInfo(anime) {
      document.title = `AstroNeko ‚Äî ${anime.title}`;
      document.getElementById("anime-bg").style.backgroundImage = `url('${anime.background}')`;
      document.getElementById("anime-image").src = anime.img;
      document.getElementById("anime-title").textContent = anime.title;
      document.getElementById("anime-description").textContent = anime.description;
      document.getElementById("anime-tags").textContent = anime.tags.join(", ");
      document.getElementById("anime-status").textContent = anime.status;
      document.getElementById("anime-age").textContent = anime.age;
      document.getElementById("anime-rating").textContent = anime.rating || "N/A";

      const seasonList = document.getElementById("season-list");
      seasonList.innerHTML = "";

      // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–µ–∑–æ–Ω—ñ–≤
      anime.seasons.forEach(season => {
          const seasonDiv = document.createElement("div");
          seasonDiv.classList.add("season");

          const seasonTitle = document.createElement("h4");
          seasonTitle.textContent = `–°–µ–∑–æ–Ω ${season.seasonNumber}: "${season.title}"`;
          seasonDiv.appendChild(seasonTitle);

          // –î–æ–¥–∞—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä—ñ–∫ —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–µ—Ä—ñ–π
          const seasonMeta = document.createElement("div");
          seasonMeta.classList.add("season-meta");
          seasonMeta.innerHTML = `
              <span class="season-year">${season.year} —Ä—ñ–∫</span>
              <span class="season-episodes">${season.episodeCount} —Å–µ—Ä—ñ–π</span>
          `;
          seasonDiv.appendChild(seasonMeta);

          const episodeContainer = document.createElement("div");
          episodeContainer.classList.add("episode-container");

          season.episodes.forEach((ep, idx) => {
              const btn = document.createElement("button");
              btn.classList.add("episode-btn");
              btn.textContent = ep.title;
              btn.onclick = () => {
                  const url = `player.html?id=${encodeURIComponent(anime.id)}&season=${season.seasonNumber}&episode=${idx+1}`;
                  window.location.href = url;
              };
              episodeContainer.appendChild(btn);
          });

          seasonDiv.appendChild(episodeContainer);
          seasonList.appendChild(seasonDiv);
      });

      // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ñ—ñ–ª—å–º—ñ–≤
      if (anime.movies && anime.movies.length > 0) {
          const moviesBlock = document.createElement("div");
          moviesBlock.classList.add("movies-block");

          const moviesTitle = document.createElement("h4");
          moviesTitle.textContent = "–§—ñ–ª—å–º–∏";
          moviesBlock.appendChild(moviesTitle);

          // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –¥–ª—è —Ñ—ñ–ª—å–º—ñ–≤
          const moviesTable = document.createElement("table");
          moviesTable.classList.add("movies-table");
          
          // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ñ
          const tableHeader = document.createElement("tr");
          tableHeader.innerHTML = `
              <th>‚Ññ</th>
              <th>–ù–∞–∑–≤–∞ —Ñ—ñ–ª—å–º—É</th>
              <th>–î–∞—Ç–∞ —Ä–µ–ª—ñ–∑—É</th>
              <th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th>
              <th></th>
          `;
          moviesTable.appendChild(tableHeader);

          // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Ç–∞–±–ª–∏—Ü—é –¥–∞–Ω–∏–º–∏
          anime.movies.forEach((movie, idx) => {
              const row = document.createElement("tr");
              row.classList.add("movie-row");
              
              // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —Å–µ–∫—É–Ω–¥–∏ –≤ —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç
              const duration = formatDuration(movie.duration);
              
              row.innerHTML = `
                  <td class="movie-number">${movie.movieNumber}</td>
                  <td class="movie-title">${movie.name}</td>
                  <td class="movie-date">${formatDate(movie.releaseDate)}</td>
                  <td class="movie-duration">${duration}</td>
                  <td class="movie-action">
                      <button class="watch-movie-btn" data-movie="${idx + 1}">–î–∏–≤–∏—Ç–∏—Å—è</button>
                  </td>
              `;
              
              // –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–∏–≤–∏—Ç–∏—Å—è"
              const watchBtn = row.querySelector('.watch-movie-btn');
              watchBtn.onclick = () => {
                  const url = `player.html?id=${encodeURIComponent(anime.id)}&movie=${idx + 1}`;
                  window.location.href = url;
              };
              
              moviesTable.appendChild(row);
          });

          moviesBlock.appendChild(moviesTable);
          seasonList.appendChild(moviesBlock);
      }
    }

    // Auto-hide header functionality
    let lastScrollY = window.scrollY;
    const header = document.querySelector('header');
    const headerHeight = header.offsetHeight;

    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –≤—ñ–¥—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
    document.querySelector('.content-wrapper').style.paddingTop = headerHeight + 'px';

    window.addEventListener('scroll', () => {
        const currentScrollY = window.scrollY;
        
        if (currentScrollY > lastScrollY && currentScrollY > headerHeight) {
            // –°–∫—Ä–æ–ª–∏–º–æ –≤–Ω–∏–∑ - —Ö–æ–≤–∞—î–º–æ —Ö–µ–¥–µ—Ä
            header.classList.add('hidden');
        } else {
            // –°–∫—Ä–æ–ª–∏–º–æ –≤–≥–æ—Ä—É - –ø–æ–∫–∞–∑—É—î–º–æ —Ö–µ–¥–µ—Ä
            header.classList.remove('hidden');
        }
        
        lastScrollY = currentScrollY;
    });

    // –î–æ–¥–∞—Ç–∫–æ–≤–æ: –ø–æ–∫–∞–∑—É—î–º–æ —Ö–µ–¥–µ—Ä –ø—Ä–∏ —Ö–æ–≤–µ—Ä—ñ
    header.addEventListener('mouseenter', () => {
        header.classList.remove('hidden');
    });

    // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –º–∏—Ç—Ç—î–≤–æ–º—É —Ö–æ–≤–∞–Ω–Ω—é –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∫—É—Ä—Å–æ—Ä–∞
    header.addEventListener('mouseleave', () => {
        lastScrollY = window.scrollY;
    });
  </script>
</body>
</html>