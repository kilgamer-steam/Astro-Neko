<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Neko</title>
    <link rel="icon" href="images/favicon.png" type="image/png">
    <link rel="stylesheet" href="style/index.css">
</head>
<body>
    <header>
        <div class="header-left">
            <img src="images/favicon1.png" alt="logo">
            <h1>AstroNeko</h1>
        </div>

        <div class="search-container">
            <input type="text" id="search" placeholder="Пошук аніме...">
            <button id="surprise">Здивуй мене</button>
        </div>
    </header>

    <main>
        <div class="anime-grid" id="anime-grid">
            <!-- Картки аніме будуть згенеровані тут -->
        </div>
        <p id="loading" style="text-align:center; color:#ff69b4; display:none;">Завантаження...</p>
    </main>

    <script>
        let animeList = [];
        let loadedCount = 0;
        const batchSize = 20;

        // Створюємо картку аніме
        function createAnimeCard(anime) {
            const card = document.createElement('div');
            card.classList.add('anime-card');

            const front = document.createElement('div');
            front.classList.add('front');
            front.innerHTML = `
              <div class="image-container">
                <img src="${anime.img}" alt="${anime.title}" onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'">
              </div>
              <div class="title-container">
                <h3>${anime.title}</h3>
              </div>`;

            const back = document.createElement('div');
            back.classList.add('back');
            back.innerHTML = `
                <p>Жанри: ${anime.tags.join(', ')}</p>
                <p>Оцінка: ${anime.rating || 'N/A'}</p>
                <p>Статус: ${anime.status}</p>
                <button class="details-btn">Детальніше</button>
            `;
            back.querySelector('button').onclick = (e) => {
                e.stopPropagation();
                window.location.href = `anime-info.html?id=${encodeURIComponent(anime.id)}`;
            };

            card.appendChild(front);
            card.appendChild(back);
            card.onclick = () => card.classList.toggle('flipped');

            return card;
        }

        // Завантажуємо список аніме (тільки id)
        async function loadAnimeList() {
            try {
                const resp = await fetch('anime/anime-list.json');
                if (!resp.ok) throw new Error('Не вдалося завантажити anime-list.json');
                animeList = await resp.json();
                loadNextBatch(); // завантажуємо першу партію
            } catch (err) {
                console.error('Помилка при завантаженні списку аніме:', err);
            }
        }

        // Завантажуємо наступну партію карток
        async function loadNextBatch() {
            const grid = document.getElementById('anime-grid');
            const loadingText = document.getElementById('loading');
            if (loadedCount >= animeList.length) return;

            loadingText.style.display = 'block';
            const nextBatch = animeList.slice(loadedCount, loadedCount + batchSize);

            for (const animeId of nextBatch) {
                try {
                    const resp = await fetch(`anime/${encodeURIComponent(animeId)}.json`);
                    if (!resp.ok) continue;
                    const anime = await resp.json();
                    grid.appendChild(createAnimeCard(anime));
                } catch (err) {
                    console.error(`Не вдалося завантажити ${animeId}.json`, err);
                }
            }

            loadedCount += nextBatch.length;
            loadingText.style.display = 'none';
        }

        // Інфініт-скролл
        window.addEventListener('scroll', () => {
            if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
                loadNextBatch();
            }
        });

        // Кнопка "Здивуй мене"
        document.getElementById('surprise').addEventListener('click', () => {
            if (animeList.length === 0) return;
            const randomId = animeList[Math.floor(Math.random() * animeList.length)];
            window.location.href = `anime-info.html?id=${encodeURIComponent(randomId)}`;
        });

        // Пошук аніме
        document.getElementById('search').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.anime-card').forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                card.style.display = title.includes(query) ? '' : 'none';
            });
        });

        // Ініціалізація
        loadAnimeList();
        // Auto-hide header functionality for index page
let lastScrollY = window.scrollY;
const header = document.querySelector('header');
const headerHeight = header.offsetHeight;

// Встановлюємо правильний відступ для контенту
document.querySelector('main').style.paddingTop = headerHeight + 'px';

window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    
    if (currentScrollY > lastScrollY && currentScrollY > headerHeight) {
        // Скролимо вниз - ховаємо хедер
        header.classList.add('hidden');
    } else {
        // Скролимо вгору - показуємо хедер
        header.classList.remove('hidden');
    }
    
    lastScrollY = currentScrollY;
});

// Додатково: показуємо хедер при ховері
header.addEventListener('mouseenter', () => {
    header.classList.remove('hidden');
});

// Запобігаємо миттєвому хованню при виході курсора
header.addEventListener('mouseleave', () => {
    lastScrollY = window.scrollY;
});
    </script>
</body>
</html>
